<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="私、気になります！">
<meta property="og:type" content="website">
<meta property="og:title" content="前端学习之路">
<meta property="og:url" content="http://glassysky.github.io/index.html">
<meta property="og:site_name" content="前端学习之路">
<meta property="og:description" content="私、気になります！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端学习之路">
<meta name="twitter:description" content="私、気になります！">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://glassysky.github.io/"/>





  <title> 前端学习之路 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?19e25f24e7a22e21d7d506b65abb0cda";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">前端学习之路</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://glassysky.github.io/2017/04/01/single-transition-timing-function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tianhao Cui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端学习之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/01/single-transition-timing-function/" itemprop="url">
                  单次变换时间函数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-01T10:24:46+08:00">
                2017-04-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/01/single-transition-timing-function/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/04/01/single-transition-timing-function/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/04/01/single-transition-timing-function/" class="leancloud_visitors" data-flag-title="单次变换时间函数">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="总述"><a href="#总述" class="headerlink" title="总述"></a>总述</h1><p>单次变换时间函数是CSS的数据类型。我们知道在使用CSS中的transitions或者animations时，元素的某些尺寸会发生变化，而这函数就是用来描述尺寸的值的变化快慢的。这在本质上是定义了一个加速度曲线，因此在变化的过程中动画的速度总是不同的。这些函数被称为<strong>渐变函数</strong>。</p>
<p>这个函数将时间与输出的比例联系到一起。<strong>0.0</strong>表示初始状态，而<strong>1.0</strong>表示终止状态。</p>
<p><img src="https://developer.mozilla.org/files/3434/TF_with_output_gt_than_1.png" alt="加速曲线"></p>
<p><img src="https://developer.mozilla.org/files/3435/TF_with_output_gt_than_1_clipped.png" alt="加速曲线"></p>
<p>输出比例能够大于1.0（也可以小于0.0），这是因为动画可以先超越终止状态，然后再回来，有点像<strong>弹性效果</strong>。可以举个例子，比如有一个200 <em> 200的图片，我们想让它最终达到400 </em> 400的效果，但是变化的过程中图片是可以先达到500 <em> 500再回弹到400 </em> 400的。</p>
<p>然而，如果输出的值超过了可能的范围（例如颜色的值大于了255或者小于0），这个值就会被截取到离它最近的在允许范围内的值（在这个例子中就会被截取到255和0）。部分<strong>cubic-bezier()</strong>曲线展示了这个性质。</p>
<h2 id="取值"><a href="#取值" class="headerlink" title="取值"></a>取值</h2><p>CSS支持两种时间函数：立方贝塞尔曲线的子集和阶跃函数。这些函数有用之处就在于它们能够通过关键字轻松的描绘出函数曲线。</p>
<h3 id="时间函数-cubic-bezier"><a href="#时间函数-cubic-bezier" class="headerlink" title="时间函数 cubic-bezier()"></a>时间函数 cubic-bezier()</h3><p>cubic-bezier()这个函数符号定义了一个贝塞尔函数曲线。由于这个函数是连续的，因此它们通常被用来在动画的开始和结尾做平滑过渡，因此有时也被成为<strong>过度函数</strong></p>
<p>一个贝塞尔曲线由4个点定义，分别为P0、P1、P2、P3。P0和P3是曲线的起点和终点，在CSS里面，这些点被固定在代表比例的坐标轴上(横坐标代表时间的比例，纵坐标代表输出范围的比例)。P0在（0，0）点，代表了初始时间和初始状态，P3在（1，1）表示终止时间和终止状态。</p>
<p><img src="https://developer.mozilla.org/files/3433/cubic-bezier,%20example.png" alt="cubic-bezier curves"></p>
<p>并不是所有的贝塞尔函数曲线都可以用作时间函数。在CSS中，P0和P3是固定的。当有且只有P1和P2的<strong>横坐标</strong>都在[0,1]范围内的时候，贝塞尔函数曲线才是合法的。</p>
<p>贝塞尔函数曲线在纵坐标上的值如果超过了[0,1]的范围，就可能会产生弹性效果。</p>
<p>当你定义了一个不合法的贝塞尔函数曲线，CSS会忽略掉整个属性。</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cubic-bezier(x1, y1, x2, y2)</div></pre></td></tr></table></figure>
<p>其中：</p>
<p>x1,y1,x2,y2的值代表了P1、P2点的横纵坐标，从而通过这两点定义贝塞尔曲线。x1、x2的值必须在[0,1]范围内，否则整个属性就是非法的。</p>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><p>以下贝塞尔函数曲线在CSS中是<strong>合法</strong>的：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 典型贝塞尔函数曲线 */</span></div><div class="line"><span class="selector-tag">cubic-bezier</span>(0<span class="selector-class">.1</span>, 0<span class="selector-class">.7</span>, 1<span class="selector-class">.0</span>, 0<span class="selector-class">.1</span>)   </div><div class="line"></div><div class="line"><span class="comment">/* 使用整数也是合法的 */</span></div><div class="line"><span class="selector-tag">cubic-bezier</span>(0, 0, 1, 1)           </div><div class="line"></div><div class="line"><span class="comment">/* 纵坐标上的负值是合法的，这样可以产生弹性效果 */</span></div><div class="line"><span class="selector-tag">cubic-bezier</span>(0<span class="selector-class">.1</span>, <span class="selector-tag">-0</span><span class="selector-class">.6</span>, 0<span class="selector-class">.2</span>, 0)    </div><div class="line"></div><div class="line"><span class="comment">/* 纵坐标上的值大于1也合法，同样产生弹性效果 */</span></div><div class="line"><span class="selector-tag">cubic-bezier</span>(0, 1<span class="selector-class">.1</span>, 0<span class="selector-class">.8</span>, 4)</div></pre></td></tr></table></figure>
<p>以下贝塞尔函数曲线在CSS中是合<strong>非法</strong>的：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 尽管输出类型应该是颜色，但是贝塞尔函数只对数值起作用 */</span></div><div class="line"><span class="selector-tag">cubic-bezier</span>(0<span class="selector-class">.1</span>, <span class="selector-tag">red</span>, 1<span class="selector-class">.0</span>, <span class="selector-tag">green</span>) </div><div class="line"></div><div class="line"><span class="comment">/* 横坐标必须在[0,1]范围内，否则曲线就不是时间的函数 */</span></div><div class="line"><span class="selector-tag">cubic-bezier</span>(2<span class="selector-class">.45</span>, 0<span class="selector-class">.6</span>, 4, 0<span class="selector-class">.1</span>)    </div><div class="line"></div><div class="line"><span class="comment">/* P1、P2两个点都要定义，不存在默认值 */</span></div><div class="line"><span class="selector-tag">cubic-bezier</span>(0<span class="selector-class">.3</span>, 2<span class="selector-class">.1</span>)   </div><div class="line"></div><div class="line"><span class="comment">/* 横坐标必须在[0,1]范围内，否则曲线就不是时间的函数 */</span></div><div class="line"><span class="selector-tag">cubic-bezier</span>(<span class="selector-tag">-1</span><span class="selector-class">.9</span>, 0<span class="selector-class">.3</span>, <span class="selector-tag">-0</span><span class="selector-class">.2</span>, 2<span class="selector-class">.1</span>)</div></pre></td></tr></table></figure>
<h3 id="时间函数-steps"><a href="#时间函数-steps" class="headerlink" title="时间函数 steps()"></a>时间函数 steps()</h3><p>steps() 函数符号定义了一个阶跃函数，它把输出值域划分为了几等份。</p>
<p>阶跃函数的子集有时候也被成为<strong>阶梯函数</strong>。</p>
<h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">steps(number_of_steps, direction)</div></pre></td></tr></table></figure>
<p>其中：</p>
<p>[number_of_steps]：这个参数是一个正整数，表示阶跃函数要把输出域划分为几个部分</p>
<p>[direction]：这个参数表示这个函数是做连续的还是右连续的。</p>
<ul>
<li>start表示左连续，因此第一次阶跃在动画开始的时候产生</li>
</ul>
<p><img src="https://developer.mozilla.org/files/3436/steps(2,start" alt="">.png)</p>
<ul>
<li>end表示右连续，因此最后一次阶跃在动画结束时发生（默认值）</li>
</ul>
<p><img src="https://developer.mozilla.org/files/3437/steps(4,end" alt="">.png)</p>
<h4 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h4><p>以下时间函数是<strong>合法</strong>的：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 有5级阶梯，最后一次阶跃发生在动画结束的瞬间 */</span></div><div class="line"><span class="selector-tag">steps</span>(5, <span class="selector-tag">end</span>)</div><div class="line"></div><div class="line"><span class="comment">/* 有两级阶梯，第一次发生在动画开始的瞬间 */</span></div><div class="line"><span class="selector-tag">steps</span>(2, <span class="selector-tag">start</span>)        </div><div class="line"></div><div class="line"><span class="comment">/* 第二个参数可选 */</span></div><div class="line"><span class="selector-tag">steps</span>(2)</div></pre></td></tr></table></figure>
<p>以下时间函数是<strong>非法</strong>的：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 第一个参数必须是一个整数，而不是一个所谓的"值" */</span></div><div class="line"><span class="selector-tag">steps</span>(2<span class="selector-class">.0</span>, <span class="selector-tag">end</span>)</div><div class="line"></div><div class="line"><span class="comment">/* 第一个参数必须为正数 */</span></div><div class="line"><span class="selector-tag">steps</span>(<span class="selector-tag">-3</span>, <span class="selector-tag">start</span>)</div><div class="line"></div><div class="line"><span class="comment">/* 至少要有一级阶跃 */</span></div><div class="line"><span class="selector-tag">steps</span>(0, <span class="selector-tag">end</span>)</div></pre></td></tr></table></figure>
<h3 id="时间函数-关键字"><a href="#时间函数-关键字" class="headerlink" title="时间函数 关键字"></a>时间函数 关键字</h3><h4 id="linear-线性"><a href="#linear-线性" class="headerlink" title="linear(线性)"></a>linear(线性)</h4><p>这个关键字表示函数<code>cubic-bezier(0.0, 0.0, 1.0, 1.0)</code>。使用这个时间函数，动画将会以一个固定的速度从起始状态径直过渡到终止状态。</p>
<p><img src="https://developer.mozilla.org/files/3425/cubic-bezier,linear.png" alt="linear img"></p>
<h4 id="ease-缓动"><a href="#ease-缓动" class="headerlink" title="ease(缓动)"></a>ease(缓动)</h4><p>这个关键字表示函数<code>cubic-bezier(0.25, 0.1, 0.25, 1.0)</code>。这个函数和接下来提到的<code>ease-in-out</code>很像，但是它在初始时刻的加速度要更大，加速度在中途变低，最后慢慢停下来。</p>
<p><img src="https://developer.mozilla.org/files/3429/cubic-bezier,ease.png" alt="ease"></p>
<h4 id="ease-in-缓入"><a href="#ease-in-缓入" class="headerlink" title="ease-in(缓入)"></a>ease-in(缓入)</h4><p>这个关键字表示时间函数<code>cubic-bezier(0.42, 0.0, 1.0, 1.0)</code>。动画在开始时是缓慢的，然后加速度逐渐变大，直到到达终止状态，最后动画会突然停下。</p>
<p><img src="https://developer.mozilla.org/files/3426/cubic-bezier,ease-in.png" alt="ease-in"></p>
<h4 id="ease-in-out-缓入缓出"><a href="#ease-in-out-缓入缓出" class="headerlink" title="ease-in-out(缓入缓出)"></a>ease-in-out(缓入缓出)</h4><p>这个关键字表示时间函数<code>cubic-bezier(0.42, 0.0, 0.58, 1.0)</code>。在这个时间函数中，动画起初变化缓慢，而后加速度变大，而后在接近最终状态的时候变慢。在动画初始阶段，它的行为类似<code>ease-in</code>；结束阶段类似<code>ease-out</code>。</p>
<p><img src="https://developer.mozilla.org/files/3428/cubic-bezier,ease-in-out.png" alt="ease-in-out"></p>
<h4 id="ease-out-缓出"><a href="#ease-out-缓出" class="headerlink" title="ease-out(缓出)"></a>ease-out(缓出)</h4><p>这个关键词表示时间函数<code>cubic-bezier(0.0, 0.0, 0.58, 1.0)</code>。动画在开始时快，在趋近于终止状态时变慢。</p>
<h4 id="step-start-起始阶跃"><a href="#step-start-起始阶跃" class="headerlink" title="step-start(起始阶跃)"></a>step-start(起始阶跃)</h4><p>这个关键字表示时间函数<code>steps(1, start))</code>。使用这个时间函数，动画迅速跳转到终止状态，并且一直保持这个状态到动画结束。</p>
<p><img src="https://developer.mozilla.org/files/3423/steps\(1,start\" alt="step-start">.png)</p>
<h4 id="step-end-末端阶跃"><a href="#step-end-末端阶跃" class="headerlink" title="step-end(末端阶跃)"></a>step-end(末端阶跃)</h4><p>这个关键字表示时间函数<code>steps(1, end)</code>。使用这个时间函数，动画一直保持初始状态，然后在动画结束时迅速跳转到终止状态。</p>
<p><img src="https://developer.mozilla.org/files/3424/steps\(1,end\" alt="step-end">.png)</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/single-transition-timing-function" target="_blank" rel="external">原文地址</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://glassysky.github.io/2017/03/29/css-transition/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tianhao Cui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端学习之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/29/css-transition/" itemprop="url">
                  CSS 动画之——transition
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-29T12:29:44+08:00">
                2017-03-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/29/css-transition/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/03/29/css-transition/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/03/29/css-transition/" class="leancloud_visitors" data-flag-title="CSS 动画之——transition">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="CSS-transitions"><a href="#CSS-transitions" class="headerlink" title="CSS transitions"></a>CSS transitions</h1><p>在改变CSS属性的时候，transitions提供给了开发者一共方式去控制动画的速度。</p>
<p>通常来讲，属性改变所产生的影响是<strong>立刻生效</strong>的，举个例子：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.img</span> &#123;</div><div class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.img</span><span class="selector-pseudo">:hover</span> &#123;</div><div class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>触发hover的时候，你将看到图片在瞬间被放大，这种突兀的变化会带来很差的用户体验。</p>
<p>而使用CSS transitions就可以展现出变化过程中的<strong>过渡段</strong>。也就是说，transitions会将整个变化的过程展现出来，而不是简单的始态-&gt;末态。</p>
<p>CSS transitions可以让开发者自己决定动画行为。包括动画属性、什么时间开始动画、动画持续时间以及动画的类型。</p>
<h2 id="哪些CSS属性能够使用动画？"><a href="#哪些CSS属性能够使用动画？" class="headerlink" title="哪些CSS属性能够使用动画？"></a>哪些CSS属性能够使用动画？</h2><p>以下属性都可以使用动画</p>
<p><img src="http://om38qdwes.bkt.clouddn.com/transition.png" alt="transition"></p>
<p>上图中的可用属性集合可能会随着时间推移发生变化，开发者应该时刻关注最新的可用属性。</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_animated_properties" target="_blank" rel="external">这里</a>可以看到最新的标准。</p>
<h2 id="使用多个动画属性"><a href="#使用多个动画属性" class="headerlink" title="使用多个动画属性"></a>使用多个动画属性</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.box</span> &#123;</div><div class="line">    <span class="attribute">border-style</span>: solid;</div><div class="line">    <span class="attribute">border-width</span>: <span class="number">1px</span>;</div><div class="line">    <span class="attribute">display</span>: block;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">background-color</span>: <span class="number">#0000FF</span>;</div><div class="line">    <span class="attribute">-webkit-transition</span>: width <span class="number">2s</span>, height <span class="number">2s</span>, background-color <span class="number">2s</span>, -webkit-transform <span class="number">2s</span>;</div><div class="line">    <span class="attribute">transition</span>: width <span class="number">2s</span>, height <span class="number">2s</span>, background-color <span class="number">2s</span>, transform <span class="number">2s</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span> &#123;</div><div class="line">    <span class="attribute">background-color</span>: <span class="number">#FFCCCC</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(180deg);</div><div class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(180deg);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="用于定义transitions的CSS属性"><a href="#用于定义transitions的CSS属性" class="headerlink" title="用于定义transitions的CSS属性"></a>用于定义transitions的CSS属性</h2><p>可以看到上一个例子中，<strong>transition</strong>属性的值有一大堆，如果动画再复杂一些，这个值就会更长；为了保证程序的可读性，建议使用CSS属性对其进行定义。</p>
<h3 id="transition-property"><a href="#transition-property" class="headerlink" title="transition-property"></a>transition-property</h3><p>指定需要应用transition的属性名称，只有被列出的这些属性在动画过程中是连续变化的，未列出的属性保持原来的行为。</p>
<p>上面的例子可以写成如下形式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">.box &#123;</div><div class="line">  ...</div><div class="line">  -webkit-transition-property: width, height, background-color, -webkit-transform;</div><div class="line">  transition-property: width, height, background-color, transform;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="transition-duration"><a href="#transition-duration" class="headerlink" title="transition-duration"></a>transition-duration</h3><p><strong>transiton-property</strong>只指出了需要应用动画的属性，接下来我们要使用<strong>transition-duration</strong>指定动画的过渡时间。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">.box &#123;</div><div class="line">  ...</div><div class="line">  -webkit-transition-property: width, height, background-color, -webkit-transform;</div><div class="line">  transition-property: width, height, background-color, transform;</div><div class="line">  &lt;!--new--&gt;</div><div class="line">  -webkit-transition-duration: 2s;</div><div class="line">  tansition-duration: 2s;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的程序表示所有属性的变换都经过2s时间，如果我们想要让不同的属性的变换持续时间不同呢？</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.box</span> &#123;</div><div class="line">  <span class="attribute">transition-property</span>: width, height, background-color, transform;</div><div class="line">  <span class="attribute">tansition-duration</span>: <span class="number">2s</span>, <span class="number">1s</span>, <span class="number">3s</span>, <span class="number">5s</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样我们就定义了不同属性的不同持续时间。</p>
<p>如果属性名和持续时间的数量的对应相等的，则属性名和持续时间是一一对应的关系，即上面的程序有如下的变换时间:</p>
<ul>
<li>width: 2s</li>
<li>height: 1s</li>
<li>background-color: 3s</li>
<li>transform: 5s</li>
</ul>
<p>如果属性名和持续时间定义的个数不同，则按照如下规则</p>
<p>如果属性名个数 &gt; 持续时间个数<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">.box &#123;</div><div class="line">  transition-property: width, height, background-color, transform;</div><div class="line">  tansition-duration: 2s, 1s;</div><div class="line">  &lt;!--等同于--&gt;</div><div class="line">  transition-property: width, height, background-color, transform;</div><div class="line">  tansition-duration: 2s, 1s, 2s, 1s;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果属性名个数 &lt; 持续时间个数<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">.box &#123;</div><div class="line">  transition-property: width, height, background-color, transform;</div><div class="line">  tansition-duration: 2s, 1s, 3s, 5s, 6s;</div><div class="line">  &lt;!--等同于--&gt;</div><div class="line">  transition-property: width, height, background-color, transform;</div><div class="line">  tansition-duration: 2s, 1s, 3s, 5s;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>总结一下就是时间个数少的进行重复，多的截取。</p>
<h3 id="transition-timing-function"><a href="#transition-timing-function" class="headerlink" title="transition-timing-function"></a>transition-timing-function</h3><p>用贝塞尔曲线作为动画的过渡函数。它决定了变换的过程是怎样的，是<strong>快-慢-快</strong>或是<strong>慢-快-慢</strong>又或者是<strong>线性变换</strong>等等，通过设置不同的贝塞尔曲线，我们可以得到不同的过渡动画。它只改变转换的过程，但不影响变换最终的结果。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">.box &#123;</div><div class="line">  transition-timing-function: ease;</div><div class="line">  transition-timing-function: linear;</div><div class="line">  transition-timing-function: step-end;</div><div class="line">  transition-timing-function: steps(4, end);</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>具体函数的说明可以参考<a href="http://cthblog.cn/2017/04/01/single-transition-timing-function/" target="_blank" rel="external">这篇文章</a></p>
<h3 id="transition-delay"><a href="#transition-delay" class="headerlink" title="transition-delay"></a>transition-delay</h3><p>定义了从属性改变到变换开始之间的间隔时间。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.box</span> &#123;</div><div class="line">  <span class="attribute">transition-delay</span>: <span class="number">0.5s</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="缩略写法"><a href="#缩略写法" class="headerlink" title="缩略写法"></a>缩略写法</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.box</span> &#123;</div><div class="line">  <span class="attribute">transition</span>: &lt;property&gt; &lt;duration&gt; &lt;timing-function&gt; &lt;delay&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="监听transitions的启动和完成"><a href="#监听transitions的启动和完成" class="headerlink" title="监听transitions的启动和完成"></a>监听transitions的启动和完成</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">el.addEventListener(<span class="string">"transitionstart"</span>, func1, <span class="literal">true</span>);</div><div class="line">el.addEventListener(<span class="string">"transitionrun"</span>, func2, <span class="literal">true</span>);</div><div class="line">el.addEventListener(<span class="string">"transitionend"</span>, func3, <span class="literal">true</span>);</div></pre></td></tr></table></figure>
<p><strong>TransitionEvent</strong>对象除了常规<strong>Event</strong>对象所包含的属性之外，还包括了两个属性：</p>
<ul>
<li>propertyName</li>
<li>elapsedTime</li>
</ul>
<h3 id="propertyName"><a href="#propertyName" class="headerlink" title="propertyName"></a>propertyName</h3><p>表示触发当前事件的属性名</p>
<h3 id="elapsedTime"><a href="#elapsedTime" class="headerlink" title="elapsedTime"></a>elapsedTime</h3><p>一个用来表示转换触发了多长时间的浮点数</p>
<p>这是一个<a href="http://jsfiddle.net/9h261pzo/291/" target="_blank" rel="external">简单的例子</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Transitions/Using_CSS_transitions" target="_blank" rel="external">参考文章</a></p>
<p>转载请注明出处</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://glassysky.github.io/2017/03/25/http-cache/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tianhao Cui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端学习之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/25/http-cache/" itemprop="url">
                  HTTP 缓存机制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-25T10:07:32+08:00">
                2017-03-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/25/http-cache/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/03/25/http-cache/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/03/25/http-cache/" class="leancloud_visitors" data-flag-title="HTTP 缓存机制">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="绪论"><a href="#绪论" class="headerlink" title="绪论"></a>绪论</h2><p>当web请求到达缓存时，如果本地有”已缓存”的副本，就可以从本地设备而不是原始服务器中提取这个文档</p>
<h3 id="使用缓存的好处"><a href="#使用缓存的好处" class="headerlink" title="使用缓存的好处"></a>使用缓存的好处</h3><ul>
<li>减少了冗余的数据传输</li>
<li>缓解了网络瓶颈的问题</li>
<li>降低了对原始服务器的要求</li>
<li>降低了距离时延</li>
</ul>
<h2 id="应用缓存时可能会出现的几种情况"><a href="#应用缓存时可能会出现的几种情况" class="headerlink" title="应用缓存时可能会出现的几种情况"></a>应用缓存时可能会出现的几种情况</h2><h3 id="命中的和未命中的"><a href="#命中的和未命中的" class="headerlink" title="命中的和未命中的"></a>命中的和未命中的</h3><p>可用的已有副本为某些到达缓存的请求提供服务，这被称为<strong>缓存命中</strong>。</p>
<p>其他一些到达缓存的请求可能会由于没有副本可用，而被转发给原始服务器，这被称为<strong>缓存未命中</strong>。</p>
<p><img src="http://om38qdwes.bkt.clouddn.com/%E5%91%BD%E4%B8%AD%E4%B8%8E%E6%9C%AA%E5%91%BD%E4%B8%AD.png" alt="缓存命中与未命中"></p>
<h3 id="缓存再验证命中与缓存再验证未命中"><a href="#缓存再验证命中与缓存再验证未命中" class="headerlink" title="缓存再验证命中与缓存再验证未命中"></a>缓存再验证命中与缓存再验证未命中</h3><p>下面问题就来了，如果我们一直使用缓存中的文档，如何把服务器上最新的变动告知客户端？</p>
<p>HTTP使用了一些简单的机制，来保持已缓存数据与服务器数据之间的一致性。</p>
<p>通过『新鲜度检测』（也叫做HTTP再验证）可以对服务器上的文档进行检测，从而查看当前缓存的文档是不是服务器上的最新版本。</p>
<p><img src="http://om38qdwes.bkt.clouddn.com/%E5%86%8D%E9%AA%8C%E8%AF%81%E5%91%BD%E4%B8%AD%E4%B8%8E%E6%9C%AA%E5%91%BD%E4%B8%AD.png" alt="缓存再验证命中与未命中"></p>
<p>HTTP通过在请求首部添加”If-Modified-Since”字段，可以实现再验证的过程。再验证的结果有以下三种可能：</p>
<ul>
<li>再验证命中：即缓存中的副本与服务器中的文档依然相同，服务器返回<strong>304 Not Modified</strong>，表示服务器对象未被更改</li>
<li>再验证未命中：即服务器上的文档发生了变动，服务器返回完整的<strong>200 OK</strong>响应，表示服务器对象已与缓存对象不同，重新从服务器获取对象</li>
<li>对象被删除：服务器返回一个<strong>404 Not Found</strong>响应，表示服务器上该对象已被删除</li>
</ul>
<p>下面对缓存机制进行详细说明</p>
<h2 id="缓存机制"><a href="#缓存机制" class="headerlink" title="缓存机制"></a>缓存机制</h2><p><img src="http://om38qdwes.bkt.clouddn.com/cache-flow.png" alt="cache-flow"></p>
<h3 id="过程一"><a href="#过程一" class="headerlink" title="过程一"></a>过程一</h3><p>客户端发送一个GET请求到缓存，并判断缓存中是否存在所请求文件的副本。</p>
<p>=== 有，则进入 -&gt; <a href="#过程五">过程五</a> ===</p>
<p>=== 没有，则进入 -&gt; <a href="#过程二">过程二</a> ===</p>
<h3 id="过程二"><a href="#过程二" class="headerlink" title="过程二"></a>过程二</h3><p>当前缓存中没有所请求文件的副本，则将请求转发到服务器。</p>
<p>=== 进入 -&gt; <a href="#过程三">过程三</a> ===</p>
<h3 id="过程三"><a href="#过程三" class="headerlink" title="过程三"></a>过程三</h3><p>服务器收到请求，将完整的请求内容包含在响应里。</p>
<p>通过特殊的HTTP<strong>Cache-Control</strong>首部和<strong>Expires</strong>首部，HTTP让服务器向每个文档附加了一个”过期时间”，并将文档存入缓存当中。在文档过期之前，缓存可以任意频率使用这些副本，而无需与服务器联系(除非请求中有限制)。</p>
<p>同时，响应头还包括<strong>Last-Modified</strong>首部和<strong>Etag</strong>首部。这两个首部表示此时请求的文件最新一次修改是什么时候（Last-Modified:&lt; date &gt;）和当前的标签是什么（Etag:&lt; tag &gt;）。</p>
<p><img src="http://om38qdwes.bkt.clouddn.com/cache-control.png" alt="cache-control"></p>
<p>=== 进入 -&gt; <a href="#过程四">过程四</a> ===</p>
<h3 id="过程四"><a href="#过程四" class="headerlink" title="过程四"></a>过程四</h3><p>缓存最后将收到的文档提供给客户端</p>
<p>=== OVER ===</p>
<h3 id="过程五"><a href="#过程五" class="headerlink" title="过程五"></a>过程五</h3><p>检测缓存中对应文件的过期时间，判断文档是否”新鲜”</p>
<p>=== 新鲜，则进入 -&gt; <a href="#过程六">过程六</a> ===</p>
<p>=== 不新鲜，则进入 -&gt; <a href="#过程七">过程七</a> ===</p>
<h3 id="过程六"><a href="#过程六" class="headerlink" title="过程六"></a>过程六</h3><p>直接将缓存中的文件提供给客户端</p>
<p>=== OVER ===</p>
<h3 id="过程七"><a href="#过程七" class="headerlink" title="过程七"></a>过程七</h3><p>用条件方法进行再验证：缓存向原始服务器发送一个”条件GET”</p>
<p>HTTP定义了5个条件请求首部。</p>
<ul>
<li>If-Modified-Since</li>
<li>If-Unmodified-Since</li>
<li>If-Match</li>
<li>If-None-Match</li>
<li>If-Range</li>
</ul>
<p>其中最有用的是<strong>If-Modified-Since</strong>和<strong>If-None-Match</strong></p>
<p>还记得上文提到的服务器响应中的<strong>Last-Modified</strong>首部和<strong>Etag</strong>首部吗？在发送”条件请求的时候”，请求首部中<strong>If-Modified-Since</strong>的值即为上次在响应中收到的<strong>Last-Modified</strong>的值，而<strong>If-None-Match</strong>的值即为上次收到的响应中<strong>Etag</strong>的值。</p>
<p>举个例子来说明:</p>
<p>假设”今天”是 2017年3月20日，在这一天，服务器上A文件最后的更新日期为 2017年3月18日 00:00。客户端在”今天”向服务器请求A文件，服务端返回内容的同时，在响应头添加了<strong>Last-Modified: 2017年3月18日 00:00</strong>（注：真正的日期格式应该是这种:<strong>Tue, 10 Jan 2017 16:05:44 GMT</strong>，这里为了方便进行了简写），客户端收到响应之后表示已经知道这个文件在服务端的最后更改日期是哪天了。下次客户端再发送条件请求的时候，就将<strong>If-Modified—Since</strong>设置为之前收到的<strong>Last-Modified</strong>首部的值。通过这种方式就能够检测距离上次请求到现在这一刻位置，所请求对象是否发生改变。</p>
<p><strong>Etag</strong>和<strong>If-None-Match</strong>的使用方法也类似上述过程。</p>
<p>=== 进入 -&gt; <a href="#过程八">过程八</a> ===</p>
<h3 id="过程八"><a href="#过程八" class="headerlink" title="过程八"></a>过程八</h3><p>服务器将接收到的请求头中的<strong>If-Modified-Since</strong>和<strong>If-None-Match</strong>首部的值取出，并与服务器上对应请求的文档信息进行对比</p>
<p>=== 条件为真，则表示文件已发生变动，进入 -&gt; <a href="#过程十一">过程十一</a> ===</p>
<p>=== 条件为假，则表示文件没有变化，进入 -&gt; <a href="#过程九">过程九</a> ===</p>
<h3 id="过程九"><a href="#过程九" class="headerlink" title="过程九"></a>过程九</h3><p>服务端返回 <strong>304 Not Modified</strong>，并且在响应头中加入新的<strong>Cache-Control</strong>和/或<strong>Expires</strong>首部，用来更新缓存上的”新鲜度信息”。</p>
<p>=== 进入 -&gt; <a href="#过程十">过程十</a> ===</p>
<h3 id="过程十"><a href="#过程十" class="headerlink" title="过程十"></a>过程十</h3><p>将缓存中的文件提供给客户端</p>
<p>=== OVER ===</p>
<h3 id="过程十一"><a href="#过程十一" class="headerlink" title="过程十一"></a>过程十一</h3><p>向服务端请求更新后的文件</p>
<p>=== 进入 -&gt; <a href="#过程三">过程三</a> ===</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p>该首部可以设置的值：</p>
<p>max-age=XXXX（设置相对秒数，即还有XXXX秒文件变为”不新鲜”）<br>s-maxage=XXXX（仅适用于共有缓存）<br>no-store（禁止缓存对响应进行复制）<br>no-cache（响应可以存在缓存中，但是每次都要进行再验证）</p>
<h3 id="Expires-和-Cache-Control"><a href="#Expires-和-Cache-Control" class="headerlink" title="Expires 和 Cache-Control"></a>Expires 和 Cache-Control</h3><p>Expirese使用<strong>绝对日期</strong>，但由于许多服务器时钟都不同步，因此不建议使用</p>
<p>而<strong>Cache-Control</strong>则使用相对时间</p>
<h3 id="If-Modified-Since-和-If-None-Match"><a href="#If-Modified-Since-和-If-None-Match" class="headerlink" title="If-Modified-Since 和 If-None-Match"></a>If-Modified-Since 和 If-None-Match</h3><p>当请求中同时存在<strong>If-Modified-Since</strong> 和 <strong>If-None-Match</strong>两种首部，则只有当两者条件都为真的时候，服务器才返回<strong>304 Not Modified</strong></p>
<p>如叙述有错误请指正，转载请注明，谢谢！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://glassysky.github.io/2017/03/16/what-happens-when-you-type-in-a-url-in-browser/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tianhao Cui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端学习之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/16/what-happens-when-you-type-in-a-url-in-browser/" itemprop="url">
                  在浏览器地址栏键入url之后发生了什么
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-16T14:47:48+08:00">
                2017-03-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/16/what-happens-when-you-type-in-a-url-in-browser/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/03/16/what-happens-when-you-type-in-a-url-in-browser/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/03/16/what-happens-when-you-type-in-a-url-in-browser/" class="leancloud_visitors" data-flag-title="在浏览器地址栏键入url之后发生了什么">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本篇均以输入’www.baidu.com’为例</p>
<h1 id="DNS解析"><a href="#DNS解析" class="headerlink" title="DNS解析"></a>DNS解析</h1><p>网络通讯大多数都是基于<code>TCP/IP</code>的，而<code>TCP/IP</code>又是基于<code>IP</code>的。我们输入的域名并不能被计算机网络所识别，因此需要将域名转为IP，而这个过程叫就做DNS解析。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="DNS-Domain-Name-System"><a href="#DNS-Domain-Name-System" class="headerlink" title="DNS(Domain Name System)"></a>DNS(Domain Name System)</h3><p>即<strong>计算机域名系统</strong>，它由域名解析器和域名服务器组成。</p>
<p>域名服务器：指保存有该网络中所有主机的域名和对应IP地址，并具有将域名转换为IP地址功能的服务器。<br>其中域名必须对应一个，且只能对应一个IP地址；而IP地址不一定有域名而且可以对应多个域名。</p>
<p>DNS也是应用层协议，但他是为了其他应用层协议工作的，用于将用户提供的域名解析为IP地址。</p>
<p>DNS主要基于UDP传输层协议，</p>
<h3 id="根域"><a href="#根域" class="headerlink" title="根域"></a>根域</h3><p>根域就是所谓的<code>.</code>。<br>其实我们的网址<code>www.baidu.com</code>在配置当中应该是<code>www.baidu.com.</code>(最后多了一个.)。一般我们在浏览器里输入的时候都会省略这个<code>.</code>。</p>
<h3 id="域的划分"><a href="#域的划分" class="headerlink" title="域的划分"></a>域的划分</h3><p>根域下来就叫顶级域或一级域。有两种划分方式，一种是互联网刚兴起时划分的<code>com.</code>，<code>net.</code>等；一种是按国家划分的如<code>cn.</code>，<code>jp.</code>等，<strong>每个域都有域名服务器</strong>。</p>
<p>例如 <code>.com</code> 就是一个顶级域名；而 <code>www.baidu.com</code> 不是一个域名，它是<code>baidu.com</code>这个域名里的一个叫做<code>www</code>的主机。同理，在<code>a.www.baidu.com</code>里，主机名是<code>a</code>。</p>
<h2 id="解析过程"><a href="#解析过程" class="headerlink" title="解析过程"></a>解析过程</h2><p>具体过程如下：</p>
<ol>
<li>查询本地域名服务器(10.1.1.1)，查找本地缓存中是否有<code>www.baidu.com</code>的IP地址。如果在缓存中找到，则跳到<code>#6</code>，没有找到则进行下一步；</li>
<li>在根域名服务器(.)中查询 -&gt; 返回COM顶级域名服务器的IP</li>
<li>在COM顶级域名服务器(.com)中查询 -&gt; 返回baidu.com二级域名服务器(.baidu.com)的IP</li>
<li>在baidu.com二级域名服务器(.baidu.com)中查询 -&gt; 返回主机名为<code>www</code>的服务器的IP</li>
<li>将域名及对应IP存入缓存中</li>
<li>获得域名对应IP地址</li>
</ol>
<h1 id="TCP-连接"><a href="#TCP-连接" class="headerlink" title="TCP 连接"></a>TCP 连接</h1><p>获得目标服务器的<strong>IP地址</strong>和<strong>端口号</strong>之后，客户端和服务器之间将建立一条TCP/IP连接。<br>TCP是面向连接的、无差错的、按序传输的。</p>
<h2 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h2><p>在TCP/IP协议中，TCP协议提供可靠的连接服务，采用三次握手建立一个连接。</p>
<p>第一次握手：建立连接时，客户端发送syn包(syn=j)到服务器，并进入SYN_SEND状态，等待服务器确认；</p>
<p>第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器 进入SYN_RECV状态；</p>
<p>第三次握手：客户端收到服务器的SYN＋ACK包，向服务器发送确认包ACK(ack=k+1)，此包发送完毕，客户端和服务器进入 ESTABLISHED状态，完成三次握手。 完成三次握手，客户端与服务器开始传送数据.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/533518-020ada1863d368a5.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="TCP/IP三次握手图解"></p>
<h2 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h2><p>由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。这个原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。</p>
<ol>
<li>客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送（报文段4）。</li>
<li>服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1（报文段5）。和SYN一样，一个FIN将占用一个序号。</li>
<li>服务器B关闭与客户端A的连接，发送一个FIN给客户端A（报文段6）。</li>
<li>客户端A发回ACK报文确认，并将确认序号设置为收到序号加1（报文段7）。</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/533518-2e624cf66132b589.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="TCP/IP四次挥手图解"></p>
<h1 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h1><p>TCP/IP连接建立之后，浏览器会向服务器发送一条HTTP请求报文 -&gt; 服务器向浏览器返回一条相应报文 -&gt; 关闭连接</p>
<h2 id="报文"><a href="#报文" class="headerlink" title="报文"></a>报文</h2><p>报文可分为两类: <strong>请求报文</strong>和<strong>相应报文</strong>，它们都由三部分组成</p>
<ul>
<li>起始行(对报文进行描述)</li>
<li>首部块(包含属性)</li>
<li>主体部分(包含数据-可选)</li>
</ul>
<h3 id="起始行"><a href="#起始行" class="headerlink" title="起始行"></a>起始行</h3><ul>
<li>请求报文起始行</li>
<li>相应报文起始行</li>
</ul>
<p>请求报文起始行：<method> <request-url> <version><br>相应报文起始行：<version> <status-code> <reason-phrase></reason-phrase></status-code></version></version></request-url></method></p>
<h3 id="首部块"><a href="#首部块" class="headerlink" title="首部块"></a>首部块</h3><ul>
<li>通用首部</li>
<li>请求首部</li>
<li>响应首部</li>
<li>实体首部</li>
<li>扩展首部</li>
</ul>
<h3 id="主体部分"><a href="#主体部分" class="headerlink" title="主体部分"></a>主体部分</h3><p>是HTTP报文的负荷，也就是HTTP要传输的内容</p>
<h2 id="连接方式"><a href="#连接方式" class="headerlink" title="连接方式"></a>连接方式</h2><ul>
<li>并行连接</li>
<li>持久连接</li>
</ul>
<p>通常使用 少量并行+持久 的连接方式</p>
<p>HTTP/1.0 通过客户端设置请求首部 Connection: keep-alive</p>
<p>HTTP/1.1 默认持久连接，可以设置 Connection: close 关闭（默认持久连接并不代表连接会永远持续下去）</p>
<h1 id="页面渲染"><a href="#页面渲染" class="headerlink" title="页面渲染"></a>页面渲染</h1><ul>
<li>HTML代码转化成DOM</li>
<li>CSS代码转化成CSSOM（CSS Object Model）</li>
<li>结合DOM和CSSOM，生成一棵渲染树（包含每个节点的视觉信息）</li>
<li>生成布局（layout），即将所有渲染树的所有节点进行平面合成</li>
<li>将布局绘制（paint）在屏幕上</li>
</ul>
<h2 id="重排"><a href="#重排" class="headerlink" title="重排"></a>重排</h2><p>发生条件:</p>
<ul>
<li>页面初始化</li>
<li>插入/删除节点</li>
<li>改变元素尺寸(width/height/margin/padding/border 等等)</li>
<li>浏览器窗口变化</li>
<li>元素位置改变</li>
</ul>
<h2 id="重绘"><a href="#重绘" class="headerlink" title="重绘"></a>重绘</h2><p>发生条件:</p>
<ul>
<li>重排后必有重绘</li>
<li>color</li>
<li>visibility</li>
</ul>
<p>参考：<br><a href="https://juejin.im/entry/57f10284da2f60004f5f2e5e" target="_blank" rel="external">前端经典面试题: 从输入 URL 到页面加载发生了什么？</a><br><a href="http://blog.chinaunix.net/uid-28216282-id-3757849.html" target="_blank" rel="external">DNS解析过程详解</a><br><a href="http://www.techug.com/post/https-ssl-tls.html" target="_blank" rel="external">聊聊HTTPS和SSL/TLS协议</a><br><a href="http://www.jianshu.com/p/092705233d37" target="_blank" rel="external">TCP三次握手 四次挥手全过程</a><br><a href="http://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html" target="_blank" rel="external">网页性能管理详解</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://glassysky.github.io/2017/03/14/cross-domain-methods/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tianhao Cui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端学习之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/14/cross-domain-methods/" itemprop="url">
                  跨域请求方法总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-14T23:32:04+08:00">
                2017-03-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/14/cross-domain-methods/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/03/14/cross-domain-methods/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/03/14/cross-domain-methods/" class="leancloud_visitors" data-flag-title="跨域请求方法总结">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h2><h3 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h3><p>起初的含义是指，A网页设置的Cookie，B网页不能打开，除非这两个网页”同源”。所谓”同源”是指一下几个相同:</p>
<ul>
<li>协议相同(http,https,http2等)</li>
<li>域名相同(www.example.com)</li>
<li>端口相同(www.example.com:3000)</li>
</ul>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>同源策略的出现时为了保护用户信息的安全。如果用户登录了A网站，又去浏览其他网站。如果其他网站可以获取到A网站的Cookie，重要用户信息可能就会泄露。</p>
<p>通过XHR实现Ajax的一个主要限制，来自于跨域安全策略。这种安全策略可以防止某些恶意行为，但合理的实现跨域请求对某些应用来说也是非常必要的。</p>
<h3 id="限制范围"><a href="#限制范围" class="headerlink" title="限制范围"></a>限制范围</h3><p>目前，如果非同源，共有三种行为受到限制:</p>
<ul>
<li>Cookie、LocalStorage 和 IndexedDB 无法获取</li>
<li>DOM 无法获得</li>
<li>AJAX 请求不能发送</li>
</ul>
<h2 id="规避方法"><a href="#规避方法" class="headerlink" title="规避方法"></a>规避方法</h2><p>我们首先构建出一个跨域的环境方便测试:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">├── client</div><div class="line">│   ├── app.js</div><div class="line">│   ├── package.json</div><div class="line">│   └── public</div><div class="line">│       └── src</div><div class="line">│           ├── index.html</div><div class="line">│           └── index.js</div><div class="line">└── server</div><div class="line">    ├── app.js</div><div class="line">    ├── package.json</div><div class="line">    └── public</div><div class="line">        └── src</div></pre></td></tr></table></figure>
<ul>
<li>通过<code>express</code>分别在3000和4000端口启动两个服务</li>
<li>默认server为3000端口、client在4000端口</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /server/app.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(path.join(__dirname, <span class="string">'public'</span>)))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'hello world'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'server app listening on port 3000!'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /client/app.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(path.join(__dirname, <span class="string">'public'</span>)))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'client'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">4000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'client app listening on port 4000!'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--/client/public/src/index.html--&gt;</span></div><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>环境搭建成功后，在4000端口上的js通过Ajax向3000端口的服务发送请求，就会触发跨域安全策略。</p>
<p>下面就介绍几种CORS(Cross-Origin Resource Sharing)的方法:</p>
<h3 id="原生支持"><a href="#原生支持" class="headerlink" title="原生支持"></a>原生支持</h3><p>Firefox 3.5+、Safari 4+、Chrome等主流浏览器都通过XMLHttpRequest对象实现了CORS的原生支持。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /client/public/src/index.js</span></div><div class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line"></div><div class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span> || xhr === <span class="number">304</span>) &#123;</div><div class="line">      <span class="built_in">console</span>.log(xhr.responseText)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'fail'</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同时需要对接口进行设置。通过设置<code>Access-Control-Allow-Origin</code>头可以决定来自哪些域的请求可以被实现。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /server/app.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(path.join(__dirname, <span class="string">'public'</span>)))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  + res.header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://localhost:4000'</span>);</div><div class="line">  res.send(<span class="string">'hello world'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'server app listening on port 3000!'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>设置成功后重启服务，我们可以看到这时的跨域请求已经发送成功，在client的index.html页面中已经可以看到请求得到的内容</p>
<h3 id="图像Ping"><a href="#图像Ping" class="headerlink" title="图像Ping"></a>图像Ping</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /client/public/src/index.js</span></div><div class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</div><div class="line">img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'done'</span>);</div><div class="line">&#125;</div><div class="line">img.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'fail'</span>);</div><div class="line">&#125;</div><div class="line">img.src = <span class="string">'http://localhost:3000'</span>;</div></pre></td></tr></table></figure>
<p>通过创建一个<code>img</code>标签，并且设置对应的<code>src</code>，可以向目标url发送请求，但是这种方法无法收到返回的数据，只能发送<code>GET</code>请求。由于无法得到返回的数据，我们稍微改一下接口的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server/app.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(path.join(__dirname, <span class="string">'public'</span>)))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  - res.send(<span class="string">'hello world'</span>);</div><div class="line">  + <span class="built_in">console</span>.log(<span class="string">'receive get request'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'server app listening on port 3000!'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>这样我们通过命令行的输出就能够判断<code>http://localhost:3000</code>是否收到了请求。</p>
<p>刷新index.html页面后，我们可以看到控制台输出了<code>fail</code>，即图片加载失败，但是命令行会输出<code>receive get request</code>，即已经收到了通过图像Ping发送的<code>GET</code>请求。</p>
<h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><p>顾名思义 JSONP = JSON + Padding</p>
<p>不理解没关系，看下面的例子就知道了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /client/public/src/index.js</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleResponse</span> (<span class="params">response</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(response.test);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</div><div class="line">script.src = <span class="string">'http://localhost:3000/?callback=handleResponse'</span>;</div><div class="line"><span class="built_in">document</span>.body.insertBefore(script, <span class="built_in">document</span>.body.firstChild);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /server/app.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(path.join(__dirname, <span class="string">'public'</span>)))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  - res.send(<span class="string">'hello world'</span>);</div><div class="line">  + res.send(req.query.callback + <span class="string">'('</span> + <span class="string">'&#123;test: 1&#125;'</span> + <span class="string">')'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'server app listening on port 3000!'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>不难看出，服务端接口此时返回一个字符串，这个字符串的格式为<code>callback({test: 1})</code>,即用一个函数包含了一个JSON，这就是JSONP名字的由来。客户端收到这个字符串后，会对其进行调用。注意这里的<code>callback</code>就是作为请求的参数传给接口的值，因此这个参数要和自己定义的回调函数同名。</p>
<p>刷新页面重新请求时，控制台打印出<code>1</code>。这是因为返回的<code>handleResponse({test: 1})</code>字符串执行后，相当于把JSON格式的数据作为参数，这样在函数内部就能获取到了。</p>
<p>如果实在不理解的话，可以直接访问这个<a href="http://freegeoip.net/json/?callback=handleResponse" target="_blank" rel="external">链接</a>，它会返回一个JSONP字符串。</p>
<p>部分选自<a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html?20170316133323#comment-last" target="_blank" rel="external">这篇博客</a></p>
<p><strong>转载请注明出处</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Tianhao Cui" />
          <p class="site-author-name" itemprop="name">Tianhao Cui</p>
           
              <p class="site-description motion-element" itemprop="description">私、気になります！</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/glassysky" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/p/1005052813146633/home?from=page_100505&mod=TAB#place" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tianhao Cui</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      次
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://felearn.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("tKsvDfgQCXPvgaUQ6U3KSf1A-gzGzoHsz", "Ns0KRy56qrIpMhQApxLKISe7");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

</body>
</html>
