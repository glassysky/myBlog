<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="私、気になります！">
<meta property="og:type" content="website">
<meta property="og:title" content="前端学习之路">
<meta property="og:url" content="http://glassysky.github.io/index.html">
<meta property="og:site_name" content="前端学习之路">
<meta property="og:description" content="私、気になります！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端学习之路">
<meta name="twitter:description" content="私、気になります！">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://glassysky.github.io/"/>





  <title> 前端学习之路 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?19e25f24e7a22e21d7d506b65abb0cda";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">前端学习之路</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://glassysky.github.io/2017/03/18/web-app-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tianhao Cui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端学习之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/18/web-app-summary/" itemprop="url">
                  WebApp 开发总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-18T12:52:32+08:00">
                2017-03-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/18/web-app-summary/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/03/18/web-app-summary/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://glassysky.github.io/2017/03/16/what-happens-when-you-type-in-a-url-in-browser/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tianhao Cui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端学习之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/16/what-happens-when-you-type-in-a-url-in-browser/" itemprop="url">
                  在浏览器地址栏键入url之后发生了什么
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-16T14:47:48+08:00">
                2017-03-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/16/what-happens-when-you-type-in-a-url-in-browser/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/03/16/what-happens-when-you-type-in-a-url-in-browser/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本篇均以输入’www.baidu.com’为例</p>
<h1 id="DNS解析"><a href="#DNS解析" class="headerlink" title="DNS解析"></a>DNS解析</h1><p>网络通讯大多数都是基于<code>TCP/IP</code>的，而<code>TCP/IP</code>又是基于<code>IP</code>的。我们输入的域名并不能被计算机网络所识别，因此需要将域名转为IP，而这个过程叫就做DNS解析。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="DNS-Domain-Name-System"><a href="#DNS-Domain-Name-System" class="headerlink" title="DNS(Domain Name System)"></a>DNS(Domain Name System)</h3><p>即<strong>计算机域名系统</strong>，它由域名解析器和域名服务器组成。</p>
<p>域名服务器：指保存有该网络中所有主机的域名和对应IP地址，并具有将域名转换为IP地址功能的服务器。<br>其中域名必须对应一个，且只能对应一个IP地址；而IP地址不一定有域名而且可以对应多个域名。</p>
<p>DNS也是应用层协议，但他是为了其他应用层协议工作的，用于将用户提供的域名解析为IP地址。</p>
<p>DNS主要基于UDP传输层协议，</p>
<h3 id="根域"><a href="#根域" class="headerlink" title="根域"></a>根域</h3><p>根域就是所谓的<code>.</code>。<br>其实我们的网址<code>www.baidu.com</code>在配置当中应该是<code>www.baidu.com.</code>(最后多了一个.)。一般我们在浏览器里输入的时候都会省略这个<code>.</code>。</p>
<h3 id="域的划分"><a href="#域的划分" class="headerlink" title="域的划分"></a>域的划分</h3><p>根域下来就叫顶级域或一级域。有两种划分方式，一种是互联网刚兴起时划分的<code>com.</code>，<code>net.</code>等；一种是按国家划分的如<code>cn.</code>，<code>jp.</code>等，<strong>每个域都有域名服务器</strong>。</p>
<p>例如 <code>.com</code> 就是一个顶级域名；而 <code>www.baidu.com</code> 不是一个域名，它是<code>baidu.com</code>这个域名里的一个叫做<code>www</code>的主机。同理，在<code>a.www.baidu.com</code>里，主机名是<code>a</code>。</p>
<h2 id="解析过程"><a href="#解析过程" class="headerlink" title="解析过程"></a>解析过程</h2><p>具体过程如下：</p>
<ol>
<li>查询本地域名服务器(10.1.1.1)，查找本地缓存中是否有<code>www.baidu.com</code>的IP地址。如果在缓存中找到，则跳到<code>#6</code>，没有找到则进行下一步；</li>
<li>在根域名服务器(.)中查询 -&gt; 返回COM顶级域名服务器的IP</li>
<li>在COM顶级域名服务器(.com)中查询 -&gt; 返回baidu.com二级域名服务器(.baidu.com)的IP</li>
<li>在baidu.com二级域名服务器(.baidu.com)中查询 -&gt; 返回主机名为<code>www</code>的服务器的IP</li>
<li>将域名及对应IP存入缓存中</li>
<li>获得域名对应IP地址</li>
</ol>
<h1 id="TCP-连接"><a href="#TCP-连接" class="headerlink" title="TCP 连接"></a>TCP 连接</h1><p>获得目标服务器的<strong>IP地址</strong>和<strong>端口号</strong>之后，客户端和服务器之间将建立一条TCP/IP连接。<br>TCP是面向连接的、无差错的、按序传输的。</p>
<h2 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h2><p>在TCP/IP协议中，TCP协议提供可靠的连接服务，采用三次握手建立一个连接。</p>
<p>第一次握手：建立连接时，客户端发送syn包(syn=j)到服务器，并进入SYN_SEND状态，等待服务器确认；</p>
<p>第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器 进入SYN_RECV状态；</p>
<p>第三次握手：客户端收到服务器的SYN＋ACK包，向服务器发送确认包ACK(ack=k+1)，此包发送完毕，客户端和服务器进入 ESTABLISHED状态，完成三次握手。 完成三次握手，客户端与服务器开始传送数据.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/533518-020ada1863d368a5.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="TCP/IP三次握手图解"></p>
<h2 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h2><p>由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。这个原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。</p>
<ol>
<li>客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送（报文段4）。</li>
<li>服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1（报文段5）。和SYN一样，一个FIN将占用一个序号。</li>
<li>服务器B关闭与客户端A的连接，发送一个FIN给客户端A（报文段6）。</li>
<li>客户端A发回ACK报文确认，并将确认序号设置为收到序号加1（报文段7）。</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/533518-2e624cf66132b589.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="TCP/IP四次挥手图解"></p>
<h1 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h1><p>TCP/IP连接建立之后，浏览器会向服务器发送一条HTTP请求报文 -&gt; 服务器向浏览器返回一条相应报文 -&gt; 关闭连接</p>
<h2 id="报文"><a href="#报文" class="headerlink" title="报文"></a>报文</h2><p>报文可分为两类: <strong>请求报文</strong>和<strong>相应报文</strong>，它们都由三部分组成</p>
<ul>
<li>起始行(对报文进行描述)</li>
<li>首部块(包含属性)</li>
<li>主体部分(包含数据-可选)</li>
</ul>
<h3 id="起始行"><a href="#起始行" class="headerlink" title="起始行"></a>起始行</h3><ul>
<li>请求报文起始行</li>
<li>相应报文起始行</li>
</ul>
<p>请求报文起始行：<method> <request-url> <version><br>相应报文起始行：<version> <status-code> <reason-phrase></reason-phrase></status-code></version></version></request-url></method></p>
<h3 id="首部块"><a href="#首部块" class="headerlink" title="首部块"></a>首部块</h3><ul>
<li>通用首部</li>
<li>请求首部</li>
<li>响应首部</li>
<li>实体首部</li>
<li>扩展首部</li>
</ul>
<h3 id="主体部分"><a href="#主体部分" class="headerlink" title="主体部分"></a>主体部分</h3><p>是HTTP报文的负荷，也就是HTTP要传输的内容</p>
<h2 id="连接方式"><a href="#连接方式" class="headerlink" title="连接方式"></a>连接方式</h2><ul>
<li>并行连接</li>
<li>持久连接</li>
</ul>
<p>通常使用 少量并行+持久 的连接方式</p>
<p>HTTP/1.0 通过客户端设置请求首部 Connection: keep-alive</p>
<p>HTTP/1.1 默认持久连接，可以设置 Connection: close 关闭（默认持久连接并不代表连接会永远持续下去）</p>
<h1 id="页面渲染"><a href="#页面渲染" class="headerlink" title="页面渲染"></a>页面渲染</h1><ul>
<li>HTML代码转化成DOM</li>
<li>CSS代码转化成CSSOM（CSS Object Model）</li>
<li>结合DOM和CSSOM，生成一棵渲染树（包含每个节点的视觉信息）</li>
<li>生成布局（layout），即将所有渲染树的所有节点进行平面合成</li>
<li>将布局绘制（paint）在屏幕上</li>
</ul>
<h2 id="重排"><a href="#重排" class="headerlink" title="重排"></a>重排</h2><p>发生条件:</p>
<ul>
<li>页面初始化</li>
<li>插入/删除节点</li>
<li>改变元素尺寸(width/height/margin/padding/border 等等)</li>
<li>浏览器窗口变化</li>
<li>元素位置改变</li>
</ul>
<h2 id="重绘"><a href="#重绘" class="headerlink" title="重绘"></a>重绘</h2><p>发生条件:</p>
<ul>
<li>重排后必有重绘</li>
<li>color</li>
<li>visibility</li>
</ul>
<p>参考：<br><a href="https://juejin.im/entry/57f10284da2f60004f5f2e5e" target="_blank" rel="external">前端经典面试题: 从输入 URL 到页面加载发生了什么？</a><br><a href="http://blog.chinaunix.net/uid-28216282-id-3757849.html" target="_blank" rel="external">DNS解析过程详解</a><br><a href="http://www.techug.com/post/https-ssl-tls.html" target="_blank" rel="external">聊聊HTTPS和SSL/TLS协议</a><br><a href="http://www.jianshu.com/p/092705233d37" target="_blank" rel="external">TCP三次握手 四次挥手全过程</a><br><a href="http://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html" target="_blank" rel="external">网页性能管理详解</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://glassysky.github.io/2017/03/14/cross-domain-methods/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tianhao Cui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端学习之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/14/cross-domain-methods/" itemprop="url">
                  跨域请求方法总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-14T23:32:04+08:00">
                2017-03-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/14/cross-domain-methods/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/03/14/cross-domain-methods/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h2><h3 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h3><p>起初的含义是指，A网页设置的Cookie，B网页不能打开，除非这两个网页”同源”。所谓”同源”是指一下几个相同:</p>
<ul>
<li>协议相同(http,https,http2等)</li>
<li>域名相同(www.example.com)</li>
<li>端口相同(www.example.com:3000)</li>
</ul>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>同源策略的出现时为了保护用户信息的安全。如果用户登录了A网站，又去浏览其他网站。如果其他网站可以获取到A网站的Cookie，重要用户信息可能就会泄露。</p>
<p>通过XHR实现Ajax的一个主要限制，来自于跨域安全策略。这种安全策略可以防止某些恶意行为，但合理的实现跨域请求对某些应用来说也是非常必要的。</p>
<h3 id="限制范围"><a href="#限制范围" class="headerlink" title="限制范围"></a>限制范围</h3><p>目前，如果非同源，共有三种行为受到限制:</p>
<ul>
<li>Cookie、LocalStorage 和 IndexedDB 无法获取</li>
<li>DOM 无法获得</li>
<li>AJAX 请求不能发送</li>
</ul>
<h2 id="规避方法"><a href="#规避方法" class="headerlink" title="规避方法"></a>规避方法</h2><p>我们首先构建出一个跨域的环境方便测试:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">├── client</div><div class="line">│   ├── app.js</div><div class="line">│   ├── package.json</div><div class="line">│   └── public</div><div class="line">│       └── src</div><div class="line">│           ├── index.html</div><div class="line">│           └── index.js</div><div class="line">└── server</div><div class="line">    ├── app.js</div><div class="line">    ├── package.json</div><div class="line">    └── public</div><div class="line">        └── src</div></pre></td></tr></table></figure>
<ul>
<li>通过<code>express</code>分别在3000和4000端口启动两个服务</li>
<li>默认server为3000端口、client在4000端口</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /server/app.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(path.join(__dirname, <span class="string">'public'</span>)))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'hello world'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'server app listening on port 3000!'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /client/app.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(path.join(__dirname, <span class="string">'public'</span>)))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.send(<span class="string">'client'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">4000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'client app listening on port 4000!'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--/client/public/src/index.html--&gt;</span></div><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>环境搭建成功后，在4000端口上的js通过Ajax向3000端口的服务发送请求，就会触发跨域安全策略。</p>
<p>下面就介绍几种CORS(Cross-Origin Resource Sharing)的方法:</p>
<h3 id="原生支持"><a href="#原生支持" class="headerlink" title="原生支持"></a>原生支持</h3><p>Firefox 3.5+、Safari 4+、Chrome等主流浏览器都通过XMLHttpRequest对象实现了CORS的原生支持。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /client/public/src/index.js</span></div><div class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line"></div><div class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span> || xhr === <span class="number">304</span>) &#123;</div><div class="line">      <span class="built_in">console</span>.log(xhr.responseText)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'fail'</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同时需要对接口进行设置。通过设置<code>Access-Control-Allow-Origin</code>头可以决定来自哪些域的请求可以被实现。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /server/app.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(path.join(__dirname, <span class="string">'public'</span>)))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  + res.header(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://localhost:4000'</span>);</div><div class="line">  res.send(<span class="string">'hello world'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'server app listening on port 3000!'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>设置成功后重启服务，我们可以看到这时的跨域请求已经发送成功，在client的index.html页面中已经可以看到请求得到的内容</p>
<h3 id="图像Ping"><a href="#图像Ping" class="headerlink" title="图像Ping"></a>图像Ping</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /client/public/src/index.js</span></div><div class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</div><div class="line">img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'done'</span>);</div><div class="line">&#125;</div><div class="line">img.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'fail'</span>);</div><div class="line">&#125;</div><div class="line">img.src = <span class="string">'http://localhost:3000'</span>;</div></pre></td></tr></table></figure>
<p>通过创建一个<code>img</code>标签，并且设置对应的<code>src</code>，可以向目标url发送请求，但是这种方法无法收到返回的数据，只能发送<code>GET</code>请求。由于无法得到返回的数据，我们稍微改一下接口的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server/app.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(path.join(__dirname, <span class="string">'public'</span>)))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  - res.send(<span class="string">'hello world'</span>);</div><div class="line">  + <span class="built_in">console</span>.log(<span class="string">'receive get request'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'server app listening on port 3000!'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>这样我们通过命令行的输出就能够判断<code>http://localhost:3000</code>是否收到了请求。</p>
<p>刷新index.html页面后，我们可以看到控制台输出了<code>fail</code>，即图片加载失败，但是命令行会输出<code>receive get request</code>，即已经收到了通过图像Ping发送的<code>GET</code>请求。</p>
<h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><p>顾名思义 JSONP = JSON + Padding</p>
<p>不理解没关系，看下面的例子就知道了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /client/public/src/index.js</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleResponse</span> (<span class="params">response</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(response.test);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</div><div class="line">script.src = <span class="string">'http://localhost:3000/?callback=handleResponse'</span>;</div><div class="line"><span class="built_in">document</span>.body.insertBefore(script, <span class="built_in">document</span>.body.firstChild);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// /server/app.js</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> app = express()</div><div class="line"></div><div class="line">app.use(<span class="string">'/static'</span>, express.static(path.join(__dirname, <span class="string">'public'</span>)))</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  - res.send(<span class="string">'hello world'</span>);</div><div class="line">  + res.send(req.query.callback + <span class="string">'('</span> + <span class="string">'&#123;test: 1&#125;'</span> + <span class="string">')'</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'server app listening on port 3000!'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>不难看出，服务端接口此时返回一个字符串，这个字符串的格式为<code>callback({test: 1})</code>,即用一个函数包含了一个JSON，这就是JSONP名字的由来。客户端收到这个字符串后，会对其进行调用。注意这里的<code>callback</code>就是作为请求的参数传给接口的值，因此这个参数要和自己定义的回调函数同名。</p>
<p>刷新页面重新请求时，控制台打印出<code>1</code>。这是因为返回的<code>handleResponse({test: 1})</code>字符串执行后，相当于把JSON格式的数据作为参数，这样在函数内部就能获取到了。</p>
<p>如果实在不理解的话，可以直接访问这个<a href="http://freegeoip.net/json/?callback=handleResponse" target="_blank" rel="external">链接</a>，它会返回一个JSONP字符串。</p>
<p>部分选自<a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html?20170316133323#comment-last" target="_blank" rel="external">这篇博客</a></p>
<p><strong>转载请注明出处</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://glassysky.github.io/2017/03/13/understanding-HTML5-mobile-application-development/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tianhao Cui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端学习之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/13/understanding-HTML5-mobile-application-development/" itemprop="url">
                  理解HTML5移动端应用开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-13T19:11:37+08:00">
                2017-03-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/13/understanding-HTML5-mobile-application-development/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/03/13/understanding-HTML5-mobile-application-development/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开发者们可以通过HTML5简化移动应用开发的过程。HTML5移动端应用也伴随着很多问题，其中就包括性能无法与原生应用所匹敌。</p>
<p>许多组织开始转向HTML5的移动应用开发，以至于使应用的开发过程流水化，并且能够降低花销和复杂度。</p>
<p>在正确的环境下，HTML5应用能够提供给企业一个简单的替换，从而不需要进行原生应用的开发，特别是当越来越多的HTML5开发框架出现的时候。任何组织在跨平台实现移动端应用的时候，都至少应该考虑HTML5。</p>
<p>然而，HTML5应用并不是毫无挑战的。他们带来了性能和安全上的关注，并且在数据获取以及原生应用程序的接口上引发了问题。</p>
<h2 id="什么是HTML5应用？"><a href="#什么是HTML5应用？" class="headerlink" title="什么是HTML5应用？"></a>什么是HTML5应用？</h2><p>HTML5应用提供了”写一次代码，就能在任何地方运行”的移动端应用发展。有一系列移动设备优化的web页面，他们为视频、音频数据的推流，对图形和动画的处理、以及离线的支持提供了高级功能。他们也添加了语义化的元素，表单的控制和多媒体控件，而且伴随了大量的新API，它们提供了定位服务、拖动操作、本地应用缓存等等。</p>
<p>HTML5很少单独工作。更多的HTML5应用集成了CSS和JavaScript，分别定义了HTML组件如何在浏览器中渲染和对文本、对象、数组进行操作的API。许多主流的浏览器都支持这些技术，这使得实现基于web跨设备的应用的实现成为可能。</p>
<h2 id="HTML5移动端应用程序开发是如何工作的"><a href="#HTML5移动端应用程序开发是如何工作的" class="headerlink" title="HTML5移动端应用程序开发是如何工作的"></a>HTML5移动端应用程序开发是如何工作的</h2><p>HTML5移动端应用程序的开发框架工具包包括CSS库和JavaScript文件，开发者们可以将它们包含在HTML中。框架解决了由构建HTML5应用而引发的诸多问题。</p>
<p>例如，一个好的框架能够巧妙处理并重复应用文档对象模型(DOM)去提升性能。框架也使实现依赖于JavaScript的行为实现更加容易，例如屏幕转换和列表滑动。总的来说，这使得新手去创建一个HTML5应用变得更加容易了，因为许多开发的细节已经被处理过。</p>
<p>所有的框架都不相同，IT管理者必须在决定使用哪一个之前做足功课。每个框架都有自己的局限性和问题，他们经常会在应用变得更加复杂的时候被暴露出来。</p>
<p>在移动设备和浏览器之间的微小差别也影响了程序在不同环境中的表现。结果，开发者有时候会基于他们共有的特性进行构建，以此来确保跨平台编程，这些程序有可能会有损用户体验。尽管存在潜在的问题，有适当训练和经验的开发者在开发安全、基于web的高性能应用时应该没有问题。</p>
<h2 id="在构建HTML5应用的时候应该时刻注意的问题"><a href="#在构建HTML5应用的时候应该时刻注意的问题" class="headerlink" title="在构建HTML5应用的时候应该时刻注意的问题"></a>在构建HTML5应用的时候应该时刻注意的问题</h2><p>内存和性能限制是在HTML5移动应用开发时要关注的重点。开发者不仅要小心控制页面的流量，也要注意DOM的实现。对象模型越复杂，导航所需的时间越长。</p>
<p>综上，开发者应该时刻关注用户体验。为了确保用户体验的质量，HTML5移动端应用应该是轻量级的，以至于执行不会出现延迟。另外，管理者需要在多种平台上测试对应用进行测试，解决不同种类的设备、屏幕大小、浏览器和操作系统的问题。大多数应用需要支持离线操作以解决连接中断的问题。</p>
<h2 id="HTML5应用-VS-原生应用"><a href="#HTML5应用-VS-原生应用" class="headerlink" title="HTML5应用 VS 原生应用"></a>HTML5应用 VS 原生应用</h2><p>不像HTML5应用，原生的应用是基于应用运行平台上的原生语言。然而在原生应用中存在着挑战，每个平台都需要自己的应用，有一些平台需要一个应用的不同版本去支持不同平台上的不同设备。</p>
<p>HTML5是平台无关的。只要用户通过支持各种语言能力的浏览器获取到应用，应用在不同平台上也应该有相同的表现。另外，管理员只有一个代码库去维护和只要一个使用HTML5部署的包。他们能够分配bug修复并且在必要的时候可以随时更新，甚至与他们的用户进行性能在线测试，而不存在原生应用中的分配难题。</p>
<p>尽管HTML5已经走了很长一段路了，但是它仍然不能够完全实现所有的原生功能，例如多点触控手势；以及与设备内置组件的无缝结合，比如GPS。原生应用通常也会在性能上略胜一筹，因为他们是一部分机器指令。如果设计不当，HTML5应用可能会有一段很长的加载时间。</p>
<p>另外，HTML5应用受制于所有Web应用的风险。开发者必须对抗网络攻击，不正确的API使用以及通过Wi-Fi、蓝牙或者文本信息获取到设备的恶意代码的攻击。</p>
<h2 id="将HTML5和原生应用相结合"><a href="#将HTML5和原生应用相结合" class="headerlink" title="将HTML5和原生应用相结合"></a>将HTML5和原生应用相结合</h2><p>一个混合的移动端应用是一个HTML5应用运行在原生程序的容器中。应用使用设备的浏览器去渲染本地的HTML页面，当连接到设备的时候，功能就像一个原生应用。混合应用能够获取到像日历和联系人这样的功能，同时也有单个代码库能够嵌入到多个平台的优势。事实上，混合应用基本上能够做到原生应用能够做到的任何事情，包括支持离线操作和多点触控手势。一个混合应用甚至能够在外观和感觉上都模仿原生应用。然而，混合应用仍然不能表现得像原生应用一样，因为存在额外的抽象层。</p>
<p>已经出现了像PhoneGap这样的平台去实现混合移动应用。这个框架使得在开发移动端应用的时候使用HTML、CSS、JavaScript成为可能，同时也处理好了跨平台发布混合应用的细节。</p>
<p><a href="http://searchmobilecomputing.techtarget.com/feature/Understanding-HTML5-mobile-application-development" target="_blank" rel="external">原文地址</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://glassysky.github.io/2017/03/12/4-javascript-design-patterns-you-should-know/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tianhao Cui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端学习之路">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/12/4-javascript-design-patterns-you-should-know/" itemprop="url">
                  你应该知道的4种JavaScript设计模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-12T15:39:51+08:00">
                2017-03-12
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/12/4-javascript-design-patterns-you-should-know/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/03/12/4-javascript-design-patterns-you-should-know/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>每位开发者都努力写出可维护的、易读的、可复用的代码。随着应用变得越来越大，代码的结构也越来越重要。设计模式验证了解决这个挑战的重点——在特定环境中，对同类事物提供相同的组织结构。</p>
<p>JavaScript web开发者们在开发应用的时候经常会不知不觉的与设计模式打交道。</p>
<p>尽管在某些环境中使用了不同的设计模式列表，JavaScript的开发者们通常比其他开发者更常用到一些设计模式。</p>
<p>在这篇文章里，我想通过讨论这些常见的设计模式来提升你的编程能力，并且深入到JavaScript的结构当中去。</p>
<p>要讨论的设计模式包括如下几种：</p>
<ul>
<li>模块模式(Module)</li>
<li>原型模式(Prototype)</li>
<li>观察者模式(Observer)</li>
<li>单例模式(Singleton)</li>
</ul>
<p>每种模式都由几个属性构成，然而，我将会着重强调如下几个关键点：</p>
<ol>
<li>Context: 应该在什么环境下使用模式</li>
<li>Problem: 我们要通过模式去解决什么问题</li>
<li>Solution: 如果用模式去解决我们提出的问题</li>
<li>Implementation: 如何实现</li>
</ol>
<h2 id="模块设计模式-Module-Design-Pattern"><a href="#模块设计模式-Module-Design-Pattern" class="headerlink" title="模块设计模式(Module Design Pattern)"></a>模块设计模式(Module Design Pattern)</h2><p>JavaScript 模块是最被经常使用的设计模式，它可以使特定部分的代码与其他部分相独立。其提供的松散耦合支撑了良好的代码结构。</p>
<p>对于那些熟悉面向对象语言的开发者额，模块就是JavaScript中的”类”。类的好处之一就是”封装”(encapsulation)——避免自身的状态和行为被其他”类”所获取。模块模式允许公有和私有(加上更少知道的受保护的和特权)访问级别。 </p>
<p>模块应该是立即执行函数(IIFE)从而允许对私有作用域(即被闭包保护的变量和方法)的访问。看起来是这样的:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// declare private variables and/or functions</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="comment">// declare public variables and/or functions</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p>这里，在返回我们想要返回的对象之前，实例化了私有变量和方法。闭包之外的代码不能获取这些私有变量，因为他们不在同一个作用域中。来看一个更具体的实现方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> HTMLChanger = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> contents = <span class="string">'contents'</span></div><div class="line"></div><div class="line">  <span class="keyword">var</span> changeHTML = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(<span class="string">'attribute-to-change'</span>);</div><div class="line">    element.innerHTML = contents;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">callChangeHTML</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      changeHTML();</div><div class="line">      <span class="built_in">console</span>.log(contents);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">&#125;)();</div><div class="line"></div><div class="line">HTMLChanger.callChangeHTML();       <span class="comment">// Outputs: 'contents'</span></div><div class="line"><span class="built_in">console</span>.log(HTMLChanger.contents);  <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<p>注意到<code>callChangeHTML</code>绑定到了返回的对象向上，并且能够在<code>HTMLChanger</code>命名空间内被引用。然而，在模块之外，内容就不能被引用了。</p>
<h3 id="揭示模块模式-Revealing-Module-Pattern"><a href="#揭示模块模式-Revealing-Module-Pattern" class="headerlink" title="揭示模块模式(Revealing Module Pattern)"></a>揭示模块模式(Revealing Module Pattern)</h3><p><code>揭示模块模式</code>是模块模式的一个变种。其目的是在保有封装的前提下，在返回的对象字面量中暴露特定的变量和方法。像下面这样去直接实现:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Exposer = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> privateVariable = <span class="number">10</span>;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> privateMethod = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Inside a private method!'</span>);</div><div class="line">    privateVariable++;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> methodToExpose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'This is a method I want to expose!'</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> otherMethodIWantToExpose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    privateMethod();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">first</span>: methodToExpose,</div><div class="line">      <span class="attr">second</span>: otherMethodIWantToExpose</div><div class="line">  &#125;;</div><div class="line">&#125;)();</div><div class="line"></div><div class="line">Exposer.first();        <span class="comment">// Output: This is a method I want to expose!</span></div><div class="line">Exposer.second();       <span class="comment">// Output: Inside a private method!</span></div><div class="line">Exposer.methodToExpose; <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<p>尽管这看起来更加清晰了，但是仍有一个显著的缺点，就是不能够引用私有的方法。这可能会给单元测试带来挑战。同样的，公共行为也是不可覆盖的。</p>
<h2 id="原型设计模式-Prototype-Design-Pattern"><a href="#原型设计模式-Prototype-Design-Pattern" class="headerlink" title="原型设计模式(Prototype Design Pattern)"></a>原型设计模式(Prototype Design Pattern)</h2><p>任何JavaScript开发者都看到了关键字<code>prototype</code>，他们被原型继承所困扰，或者在代码中实现原型。原型设计模式依赖于JavaScript原型继承。原型模型主要被用来在性能密集的条件下创建对象。</p>
<p>通过传递原始对象的克隆(浅克隆)来创建对象。原型模式的一个使用案例是执行一个广泛的数据库操作去创建一个对象，被用作应用的其他部分。如果另一个进程需要使用这个对象，它可以直接去克隆之前的对象而不需要再执行一遍整个数据库操作。</p>
<p>为了克隆一个对象，构造器必须去实例化第一个对象。然后通过使用关键字<code>prototype</code>，变量和方法被绑定到对象的结构中。让我们看一个基本的例子:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> TeslaModelS = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.numWheels    = <span class="number">4</span>;</div><div class="line">  <span class="keyword">this</span>.manufacturer = <span class="string">'Tesla'</span>;</div><div class="line">  <span class="keyword">this</span>.make         = <span class="string">'Model S'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">TeslaModelS.prototype.go = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// Rotate wheels</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">TeslaModelS.prototype.stop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// Apply brake pads</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>构造函数允许创建一个<code>TeslaModelS</code>对象。在创建一个<code>TeslaModelS</code>对象的时候，它会在构造器中保持初始状态。另外，维护<code>go</code>和<code>stop</code>方法是很容易的，因为我们是在<code>prototype</code>中声明的他们。一个同样用来在原型上扩展函数的方法如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> TeslaModelS = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.numWheels    = <span class="number">4</span>;</div><div class="line">  <span class="keyword">this</span>.manufacturer = <span class="string">'Tesla'</span>;</div><div class="line">  <span class="keyword">this</span>.make         = <span class="string">'Model S'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">TeslaModelS.prototype = &#123;</div><div class="line">  <span class="attr">go</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// Rotate wheels</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">stop</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// Apply brake pads</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="揭示原型模式-Revealing-prototype-pattern"><a href="#揭示原型模式-Revealing-prototype-pattern" class="headerlink" title="揭示原型模式(Revealing prototype pattern)"></a>揭示原型模式(Revealing prototype pattern)</h3><p>与模块模式相似，原型模式也有揭示的变体。揭示原型模式在它返回一个对象字面量的时候，提空了公有和私有成员的封装。</p>
<p>在我们返回一个对象的时候，我们将会在原型对象前加一个<code>function</code>。通过扩展我们的上一个例子，我们能够选择我们在当前原型中希望暴露的内容，以保持其访问级别。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> TeslaModelS = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.numWheels    = <span class="number">4</span>;</div><div class="line">  <span class="keyword">this</span>.manufacturer = <span class="string">'Tesla'</span>;</div><div class="line">  <span class="keyword">this</span>.make         = <span class="string">'Model S'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">TeslaModelS.prototype = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> go = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// Rotate wheels</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> stop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// Apply brake pads</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">pressBrakePedal</span>: stop,</div><div class="line">    <span class="attr">pressGasPedal</span>: go</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;();</div></pre></td></tr></table></figure>
<p>留意stop和go函数将在返回的对象中被屏蔽，由于在返回的对象作用域之外。因为JavaScript原生就支持对象的继承，因此不需要再重写底层细节了。</p>
<h2 id="观察者设计模式"><a href="#观察者设计模式" class="headerlink" title="观察者设计模式"></a>观察者设计模式</h2><p>有很多次当我们的应用的一部分改变的时候，另一部分需要被更新。在AngularJS里面，如果<code>$scope</code>对象更新了，一个事件就能被触发，同时去提醒另一个部分。观察者模式就是对这种情况的合并——如果一个对象被更新，它会对依赖他的对象进行广播，告知它有变化发生了。</p>
<p>另一个很好的例子就是MVC架构；当数据模型更新时，视图发生改变。其中一个好处就是从数据模型中将视图解耦出来，从而减少了依赖。</p>
<p><img src="http://om38qdwes.bkt.clouddn.com/observer-pattern-UML.png" alt="Observer Design Pattern"></p>
<p>正如UML图表所示，<code>subject</code>，<code>observer</code>和<code>concrete</code>对象都是必要的对象。<code>subject</code>包含了到<code>concrete observer</code>的引用，从而能够通知任何改变。<code>observer</code>对象是一个抽象的类，它允许实际的观察者实现通知方法。</p>
<p>让我们看一个AngularJS的例子，其通过事件管理实现了观察者模式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Controller 1</span></div><div class="line">$scope.$on(<span class="string">'nameChanged'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event, args</span>) </span>&#123;</div><div class="line">    $scope.name = args.name;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment">// Controller 2</span></div><div class="line">$scope.userNameChanged = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    $scope.$emit(<span class="string">'nameChanged'</span>, &#123;<span class="attr">name</span>: name&#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>在观察者模式中，区分独立的对象或者<code>subject</code>是很重要的。</p>
<p>值得一提的是，尽管观察者模式有很多优势，但是其中一个缺点就是当观察者的数量上升时，性能会有显著的下降。其中最恼人的观察者就是<code>watchers</code>。在AngularJS里，我们能够监视变量，函数和对象。<code>$$digest</code>循环运行并且在作用域对象更新时通知每一个监视器新的值。</p>
<p>我们能够在JavaScript中创建我们自己的<code>Subject</code>和<code>Observer</code>。让我们看一下这是如何实现的:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Subject = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.observers = [];</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">subscribeObserver</span>: <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</div><div class="line">      <span class="keyword">this</span>.observers.push(observer);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">unsubscribeObserver</span>: <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> index = <span class="keyword">this</span>.observers.indexOf(observer);</div><div class="line">      <span class="keyword">if</span>(index &gt; <span class="number">-1</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.observers.splice(index, <span class="number">1</span>);</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">notifyObserver</span>: <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> index = <span class="keyword">this</span>.observers.indexOf(observer);</div><div class="line">      <span class="keyword">if</span>(index &gt; <span class="number">-1</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.observers[index].notify(index);</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">notifyAllObservers</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.observers.length; i++)&#123;</div><div class="line">        <span class="keyword">this</span>.observers[i].notify(i);</div><div class="line">      &#125;;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> Observer = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">notify</span>: <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">"Observer "</span> + index + <span class="string">" is notified!"</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Subject();</div><div class="line"></div><div class="line"><span class="keyword">var</span> observer1 = <span class="keyword">new</span> Observer();</div><div class="line"><span class="keyword">var</span> observer2 = <span class="keyword">new</span> Observer();</div><div class="line"><span class="keyword">var</span> observer3 = <span class="keyword">new</span> Observer();</div><div class="line"><span class="keyword">var</span> observer4 = <span class="keyword">new</span> Observer();</div><div class="line"></div><div class="line">subject.subscribeObserver(observer1);</div><div class="line">subject.subscribeObserver(observer2);</div><div class="line">subject.subscribeObserver(observer3);</div><div class="line">subject.subscribeObserver(observer4);</div><div class="line"></div><div class="line">subject.notifyObserver(observer2); <span class="comment">// Observer 2 is notified!</span></div><div class="line"></div><div class="line">subject.notifyAllObservers();</div><div class="line"><span class="comment">// Observer 1 is notified!</span></div><div class="line"><span class="comment">// Observer 2 is notified!</span></div><div class="line"><span class="comment">// Observer 3 is notified!</span></div><div class="line"><span class="comment">// Observer 4 is notified!</span></div></pre></td></tr></table></figure>
<h3 id="发布-订阅"><a href="#发布-订阅" class="headerlink" title="发布/订阅"></a>发布/订阅</h3><p>然而，发布/订阅模式使用了一种主题/事件的渠道，这个渠道架设在希望接收到通知的对象(订阅者)和触发事件的对象(发布者)之间。这个事件系统允许代码定义特定的应用事件，并且能够传递包含着订阅者所需的值的定制化参数。其中的想法就是避免订阅者和发布者之间的依赖。</p>
<p>这与观察者模式有所区别，因为任何一个订阅者都实现了一个适当的事件处理机制去注册和接收来自发布者的主题通知广播。</p>
<p>许多开发者选择将发布/订阅模式与观察者模式相结合，尽管两者存在差异。订阅器在发布/订阅模式中通过消息媒介被通知，但是观察者通过实现一个与subject类似的处理程序而获得通知。</p>
<p>在AngularJS里，一个订阅者<code>订阅</code>一个事件需要使用<code>$on(&#39;event&#39;, callback)</code>，发布者<code>发布</code>一个事件需要使用<code>$emit(&#39;event&#39;,args)</code>或者<code>$broadcast(&#39;event&#39;, args)</code>。</p>
<h2 id="单例模式-Singleton"><a href="#单例模式-Singleton" class="headerlink" title="单例模式(Singleton)"></a>单例模式(Singleton)</h2><p>单例模式只允许单次实例化，但是同一个对象可以有许多实例。单例模式阻止了客户端创建多个实例，在第一个对象被创建之后，他将会返回它自己的实例。</p>
<p>对于大多数之前还没有使用过单例模式的人来说，找到单例模式的用例是不容易的。一个例子是使用一个办公室的打印机。如果有十个人在办公室里，并且他们都要用一台打印机，十台电脑共享了打印机(实例)。通过共享一个打印机，他们分享了相同的资源。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> printer = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> printerInstance;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">create</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="comment">// underlying printer mechanics</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">turnOn</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="comment">// warm up</span></div><div class="line">      <span class="comment">// check for paper</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="comment">// public + private states and behaviors</span></div><div class="line">      print: print,</div><div class="line">      <span class="attr">turnOn</span>: turnOn</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">getInstance</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span>(!printerInstance) &#123;</div><div class="line">        printerInstance = create();</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> printerInstance;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Singleton</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(!printerInstance) &#123;</div><div class="line">      printerInstance = intialize();</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p><code>create</code>方法是私有的，因为我们不想让客户端去访问他，然而，<code>getInstance</code>方法是公开的。每一个办公室的员工都能通过与<code>getInstance</code>方法进行交互从而生成一个打印机的实例。向下面这样:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> officePrinter = printer.getInstance();</div></pre></td></tr></table></figure>
<p>在AngularJS里面，单例是很普遍的，最值得注意的是services，factories和providers。因为他们都保留了状态并且提供了资源的获取，创建两个实例破坏了service/factory/provider共享的关键。</p>
<p>当超过一个线程想要获取相同资源的时候，竞争这种情况就会发生在多线程程序里。单例模式很容易受到竞争的影响，因此如果没有实例在一开始被初始化，两个线程可能就会创建两个对象而不是返回实例。这违背了单例模式的设计原则。因此，当开发者在多线程应用中实现单例时，必须要保证同步。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>设计模式通常在更大的应用中被使用，然而要去理解哪一个比另一个更有优势，需要从实践中得到。</p>
<p>在构建任何应用之前，你应该全盘思考每一个行为以及他们如何与另一个进行交互。在回顾<code>Module</code>，<code>Protoytpe</code>，<code>Observer</code>和<code>Singleton</code>设计模式之后，你应该能够认识这些模式并且广泛应用他们。</p>
<p><a href="https://scotch.io/bar-talk/4-javascript-design-patterns-you-should-know" target="_blank" rel="external">原文地址</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Tianhao Cui" />
          <p class="site-author-name" itemprop="name">Tianhao Cui</p>
           
              <p class="site-description motion-element" itemprop="description">私、気になります！</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tianhao Cui</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'felearn';
      var disqus_identifier = 'index.html';

      var disqus_title = "";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      

    </script>
  










  
  

  

  

  

  


  

</body>
</html>
